import{aU as w,aV as Q,v as P,r as k,x as z,q as c,s as x,d as t,u as g,z as E,t as d,ab as N,A as e,aa as f,F as S,ar as A,Q as _}from"./index.511ce7da.js";import{a as F,Q as D}from"./QCard.c27ef320.js";import{Q as T}from"./QPage.30c35a64.js";import{Q as U}from"./QBtnGroup.79c77c2f.js";import{Q as j}from"./QMarkupTable.1a93edc0.js";import{Q as M}from"./QPagination.9af53214.js";import{d as B}from"./documentosApi.5a915086.js";import{_ as G}from"./DialogEliminar.6699e732.js";import{_ as I}from"./LoaderSpinner.276bcf78.js";import{u as H}from"./useQueryClient.esm.18f38723.js";import{u as J}from"./useMutation.esm.1025419c.js";import{u as O}from"./useQuery.esm.07b4cbcd.js";import{_ as W}from"./BreadcrumbNav.83440b84.js";import{g as X}from"./getUser.70da419d.js";import"./use-dark.2ddafa12.js";import"./QInput.b977ab79.js";import"./use-key-composition.8ed1270c.js";import"./uid.42677368.js";import"./focus-manager.05708ea9.js";import"./use-form.89097415.js";import"./format.2bc25e5f.js";import"./axios.a596eead.js";import"./QCardActions.2508ac56.js";import"./QDialog.d254dd3f.js";import"./use-prevent-scroll.b0ece3de.js";import"./focusout.f4d95c7f.js";import"./ClosePopup.41b92e43.js";import"./utils.esm.c4fd8260.js";import"./mutation.esm.d177ca9b.js";const Y=y=>{const r=H(),a=async s=>{try{Q.show({delay:500,message:"Eliminando..."}),await B.delete(`entregas/${s}`),Q.hide()}catch(h){throw Q.hide(),h}},{mutate:i,isLoading:l,error:p,isSuccess:v}=J(a,{onSuccess:()=>{w.create({message:"Se elimin\xF3 la entrega",color:"positive",position:"top-right",type:"positive"}),r.invalidateQueries({queryKey:["entregas",y]}),r.invalidateQueries({queryKey:["entregas-trashed"],exact:!1}),r.invalidateQueries({queryKey:["entrega-por-residente"],exact:!1}),r.invalidateQueries({queryKey:["documentos-pendientes"],exact:!1})},onError:s=>{w.create({message:s+"",color:"negative",position:"top-right",type:"negative"})}});return{eliminarRecurso:i,loadingEliminar:l,error:p,isSuccess:v}},Z=e("thead",null,[e("tr",null,[e("th",null,"Residente"),e("th",null,"Fecha entrega"),e("th",null,"Documento"),e("th",null,"Acci\xF3n")])],-1),ee={class:"q-mt-md flex justify-end items-center"},te={class:"q-mr-md"},ae=P({__name:"TablaEntrega",setup(y){const r=async o=>{const{data:u}=await B.get("/entregas",{params:{page:o.value,perPage:15,included:"estudiante,documento"}});return u},a=k(1),i=z(),l=k(!1),p=k(""),{isLoading:v,data:s}=O({queryKey:["entregas",a],queryFn:()=>r(a),keepPreviousData:!0,staleTime:1e3*60*10}),{eliminarRecurso:h}=Y(a.value),R=o=>{i.push({name:"ver-entrega",params:{id:o}})},K=o=>{i.push({name:"editar-entrega",params:{id:o}})},L=o=>{l.value=!0,p.value=o};return(o,u)=>{var C;return c(),x("div",null,[t(G,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=m=>l.value=m),"recurso-id":p.value,onEliminar:g(h)},null,8,["modelValue","recurso-id","onEliminar"]),g(v)?(c(),E(I,{key:0})):g(s)?(c(),E(j,{key:1},{default:d(()=>{var m;return[Z,e("tbody",null,[(c(!0),x(S,null,A((m=g(s))==null?void 0:m.data,n=>{var b,q,V;return c(),x("tr",{key:n.id},[e("td",null,f((b=n.estudiante)==null?void 0:b.nombre)+" "+f((q=n.estudiante)==null?void 0:q.apellidos),1),e("td",null,f(n.fecha_entrega),1),e("td",null,f((V=n.documento)==null?void 0:V.nombre_documento),1),e("td",null,[t(U,{push:""},{default:d(()=>[t(_,{size:"sm",color:"info",push:"",glossy:"",icon:"visibility",onClick:$=>R(n.id)},null,8,["onClick"]),t(_,{size:"sm",color:"secondary",push:"",glossy:"",icon:"edit",onClick:$=>K(n.id)},null,8,["onClick"]),t(_,{size:"sm",color:"negative",push:"",glossy:"",icon:"delete",onClick:$=>L(n.id)},null,8,["onClick"])]),_:2},1024)])])}),128))])]}),_:1})):N("",!0),e("div",ee,[e("div",te,"P\xE1gina: "+f(a.value),1),t(M,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),max:((C=g(s))==null?void 0:C.meta.last_page)||1,"direction-links":"",flat:"",color:"grey","active-color":"primary"},null,8,["modelValue","max"])])])}}}),re={class:"flex justify-between items-center"},oe=e("div",{class:"fontsize-15 text-weight-light"},"Entregas",-1),Re=P({__name:"ListarEntrega",setup(y){const r=[{label:"Entregas",icon:"assignment_turned_in"}],a=z(),i=()=>{a.push({name:"crear-entrega"})};return X(),(l,p)=>(c(),E(T,{padding:""},{default:d(()=>[t(W,{pages:r,titlePage:"Lista de entregas"}),t(D,null,{default:d(()=>[t(F,null,{default:d(()=>[e("div",re,[oe,t(_,{label:"Nuevo",icon:"add_circle_outline",color:"secondary",size:"md",padding:"xs",onClick:i})])]),_:1}),t(F,null,{default:d(()=>[t(ae)]),_:1})]),_:1})]),_:1}))}});export{Re as default};
